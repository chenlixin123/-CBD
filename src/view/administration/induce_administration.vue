<style scoped>
.box {
  width: 100%;
  min-width: 1000px;
  height: 100%;
  background: #e3e8ee;
  box-sizing: border-box;
  font-size: 0.9vw;
  color: #666;
}
>>> .ivu-btn:hover {
  background: #f66913;
  color: white;
  border: none;
  outline: none;
}
>>> .ivu-btn-primary {
  background: #f66913;
  border: 1px solid #f66913;
}
>>> .ivu-btn {
  color: white;
  background: #f66913;
  border: none;
  outline: none;
}
.search {
  width: 99%;
  min-width: 580px;
  height: 20%;
  margin: 0 auto;
  background: white;
}
.top {
  width: 100%;
  height: 60%;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
}
.bottom {
  width: 100%;
  height: 40%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-sizing: border-box;
}
.button1,
.button2,
.button3 {
  width: 10%;
  min-width: 100px;
  height: 60%;
  border: none;
  outline: none;
  background: #f66913;
  color: white;
  padding-left: 10px;
  padding-right: 10px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 0.9vw;
}
.button_right {
  width: 23%;
  height: 60%;
  margin-right: 2%;
  display: flex;
  justify-content: space-between;
}
.button1 {
  margin-left: 2.5%;
}
.moduleii {
  width: 100%;
  height: 100%;
  position: fixed;
  top: 0;
  left: 0;
  background: rgba(0, 1, 1, 0.5);
  z-index: 1;
}
.contentii {
  width: 50%;
  min-width: 750px;
  min-height: 420px;
  background: white;
  border-radius: 10px;
  /* margin-left: 30%; */
  margin: 0 auto;
  margin-top: 5%;
  /* border: 1px solid red; */
}
.content_topii {
  width: 100%;
  border-bottom: 3px solid #c5c8ce;
  box-sizing: border-box;
  padding: 2%;
}
.content_btnii {
  width: 100%;
  margin-top: 2.5%;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.input2 {
  width: 43%;
  display: flex;
  align-items: center;
  /* border: 1px solid; */
}
.content_btnsii {
  width: 18%;
  min-height: 30px;
  color: white;
  background: #f66913;
  font-size: 0.9vw;
}
.content_btnsii:hover {
  width: 18%;
  min-height: 30px;
  color: white;
  background: #f66913;
}
.content_bottomii {
  width: 100%;
  height: 70%;
  padding: 4% 2% 2% 2%;
}
.content_tableii {
  width: 100%;
  height: 100%;
  overflow: auto;
}
.input1 {
  width: 18%;
  height: 30%;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  margin-left: 2.5%;
  margin-right: 2%;
  position: relative;
  /* border: 1px solid; */
}
.input2 {
  width: 23%;
  height: 30%;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  margin-left: 2.5%;
  margin-right: 2%;
  position: relative;
  /* border: 1px solid; */
}
.input3 {
  width: 35%;
  height: 30%;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  margin-left: 2.5%;
  margin-right: 2%;
  position: relative;
  /* border: 1px solid; */
}
.text2 {
  width: 50%;
}
.seii {
  width: 100%;
}
.text {
  width: 26%;
  min-width: 65px;
  text-align-last: justify;
}
.table {
  width: 99%;
  min-width: 580px;
  margin: 0 auto;
  min-height: 70%;
  background: white;
  margin-top: 0.5%;
}
.tables1 {
  width: 100%;
  margin: 0 auto;
  margin-top: 1%;
  padding-bottom: 1%;
  text-align: right;
  display: flex;
  align-items: center;
  justify-content: flex-end;
}
.tables {
  width: 99%;
  min-width: 580px;
  margin: 0 auto;
  margin-top: 1%;
  text-align: right;
  padding-bottom: 1%;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  /* border: 1px solid; */
}
.tab {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  min-width: 200px;
  /* border: 1px solid; */
}
.page {
  margin-right: 15px;
}
>>> .ivu-switch-checked {
  border: 1px solid #f66913;
  background: #f66913;
}
>>> .ivu-btn-primary {
  background: #f66913;
  border: 1px solid #f66913;
}
.se {
  width: 70%;
  padding-left: 5px;
  outline: none;
  color: #464c5b;
}
::-webkit-input-placeholder {
  color: rgba(21, 30, 38, 0.35);
}
.demo-spin-container {
  position: absolute;
  top: 50%;
  right: 50%;
  border: 1px solid #eee;
}
.ellipsis {
  width: 100%;
  height: 30px;
  text-align: center;
  line-height: 30px;
  border: 1px solid #dcdee2;
}
.close {
  width: 80%;
  height: 100%;
  background: #afb7c9;
  border-radius: 5px;
  border: none;
  outline: none;
  color: white;
}
.close:hover {
  width: 80%;
  background: #afb7c9;
  color: white;
  cursor: pointer;
}
.button3 {
  width: 40%;
  height: 100%;
  background: #545c6a;
}
.button3:hover {
  width: 40%;
  height: 100%;
  background: #545c6a;
}
.button2 {
  width: 40%;
  height: 100%;
}
>>> .ivu-page-item-active {
  border: 1px solid #f66913;
}
>>> .ivu-page-item-active a,
>>> .ivu-page-item-active:hover a {
  color: #f66913;
}
>>> .ivu-page-item:hover {
  border: 1px solid #f66913;
}
>>> .ivu-page-item:hover a {
  color: #f66913;
}
>>> .ivu-table th {
  text-align: center;
  font-size: 18px;
  height: 3vw;
}
>>> .ivu-table td {
  font-size: 0.8vw;
  color: #666;
}
.modules_delete {
  width: 100%;
  height: 100%;
  position: fixed;
  top: 0;
  left: 0;
  background: rgba(0, 1, 1, 0.5);
  z-index: 20000000;
}
.contentes_delete {
  width: 33%;
  height: 25%;
  background: white;
  border-radius: 10px;
  position: fixed;
  top: 20%;
  right: 30%;
  z-index: 20000000;
}
.content_top_delete {
  width: 100%;
  height: 65%;
  text-align: center;
  border-bottom: 3px solid #e3e8ee;
  display: flex;
  align-items: center;
  justify-content: center;
  padding-left: 10%;
  padding-right: 10%;
}
.content_bottom_delete {
  width: 100%;
  height: 35%;
  display: flex;
  align-items: center;
  justify-content: space-around;
}
.success_delete {
  width: 35%;
  height: 60%;
  border: none;
  outline: none;
  border-radius: 5px;
  color: white;
  font-size: 0.9vw;
  background: #f66913;
  cursor: pointer;
}
.success_delete:hover {
  width: 35%;
  background: #f66913;
  color: white;
}
.canceles_delete {
  width: 35%;
  height: 60%;
  border: none;
  outline: none;
  border-radius: 5px;
  color: white;
  font-size: 0.9vw;
  background: #545c6a;
  cursor: pointer;
}
.canceles_delete:hover {
  width: 35%;
  height: 60%;
  border: none;
  outline: none;
  border-radius: 5px;
  color: white;
  font-size: 0.9vw;
  background: #545c6a;
  cursor: pointer;
}
</style>
<template>
  <div class="box">
    <!-- 搜索模块 -->
    <div class="search">
      <div class="top">
        <div class="input1">
          <div class="text">车场名称</div>：
          <i-select v-model="carname" filterable style="width:200px" clearable>
            <i-option
              v-for="(item,index) in carnames"
              :key="index"
              :value="item.parkCode"
            >{{item.parkName}}</i-option>
          </i-select>
        </div>
        <div class="input2">
          <div class="text">诱导屏编号</div>：
          <Input v-model="onename" class="se" type="text" placeholder="请输入诱导屏编号" />
        </div>
        <div class="input2">
          <div class="text">点位编号</div>：
          <Input v-model="point_number" class="se" type="text" placeholder="请输入一体机编号" />
        </div>
        <div class="input1">
          <div class="text">状态</div>：
          <i-select v-model="search_state" style="width:200px" clearable>
            <i-option
              v-for="(item,index) in search_states"
              :key="index"
              :value="item.id"
            >{{ item.value }}</i-option>
          </i-select>
        </div>
      </div>
      <div class="bottom">
        <button class="button1" @click="add">新增诱导屏</button>
        <div class="button_right">
          <Button class="button2" @click="sear">查询</Button>
          <Button class="button3" :loading="loading1" @click="out">导出</Button>
        </div>
      </div>
    </div>
    <!-- 表格模块 -->
    <div class="table">
      <Table
        highlight-row
        ref="currentRowTable"
        :no-data-text="loadingText ? loadingText : '暂无数据'"
        :columns="columns"
        :data="data.list"
        :loading="loadinges"
      ></Table>
    </div>
    <!-- 页脚 -->
    <div class="tables">
      <Page
        :total="data.total"
        show-total
        :page-size="condition.pageSize"
        :current="pages"
        @on-change="search"
        class="page"
      />
      <div class="tab">
        <div>跳至</div>
        <Input
          @input="number"
          :value="numbers"
          style="width: 50px;margin-left:5px;margin-right:5px;"
          placeholder="1"
        />
        <div>页</div>
        <Button style="margin-left:20px;" @click="jump">跳转</Button>
      </div>
    </div>
    <!-- loading -->
    <div class="demo-spin-container">
      <Spin fix size="large" v-if="spinShow"></Spin>
    </div>
    <!-- 车牌号全部显示（弹框） -->
    <Modal v-model="modal10" :closable="false">
      <p class="ellipsis" v-for="(item,index) in module_ellipsis" :key="index">{{item}}</p>
      <div slot="footer" style="width:100%;height:35px;textAlign:center;">
        <button class="close" @click="del">关闭</button>
      </div>
    </Modal>
    <!-- 新增一体机弹框 -->
    <div class="moduleii" v-if="modules">
      <div class="contentii">
        <div class="content_topii">
          <div class="content_titleii">新增诱导屏</div>
          <div class="content_btnii">
            <div class="input3">
              <div class="text2">诱导屏编号:</div>
              <Input v-model="modal_onename" class="seii" type="text" placeholder="请输入诱导屏编号" />
            </div>
            <Button class="content_btnsii" @click="sear1">查询</Button>
            <Button class="content_btnsii" @click="modal_add">增加</Button>
            <Button class="content_btnsii" @click="module_back">返回</Button>
          </div>
        </div>
        <div class="content_bottomii">
          <Table
            class="content_tableii"
            highlight-row
            ref="currentRowTable1"
            :no-data-text="loadingText1 ? loadingText1 : '暂无数据'"
            :columns="columns1"
            :data="data1.list"
            :loading="loadinges1"
          ></Table>
          <div class="tables1">
            <Page
              :total="data1.total"
              show-total
              :page-size="condition1.pageSize"
              :current="pages1"
              @on-change="search1"
              class="page"
            />
            <div class="tab">
              <div>跳至</div>
              <Input
                @input="number1"
                :value="numbers1"
                style="width: 50px;margin-left:5px;margin-right:5px;"
                placeholder="1"
              />
              <div>页</div>
              <Button style="margin-left:20px;" @click="jump1">跳转</Button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modules_delete" v-if="show_delete">
      <div class="contentes_delete">
        <div class="content_top_delete">确定删除？</div>
        <div class="content_bottom_delete">
          <Button class="success_delete" :loading="loading_delete" @click="success_delete">确定</Button>
          <Button class="canceles_delete" @click="canceles_delete">取消</Button>
        </div>
      </div>
    </div>
  </div>
</template>
<script>
import url from "@/api/url";
import axios from "@/libs/api.request";
import axios1 from "@/libs/api.request.json";
export default {
  data() {
    return {
      point_number: "", //点位编号
      search_state: "", //状态
      search_states: [
        {
          id: 0,
          value: "离线"
        },
        {
          id: 1,
          value: "在线"
        }
      ],
      deletes: "",
      id_delete: "",
      show_delete: false,
      loading_delete: false,
      totalPages: "",
      totalPages1: "",
      carname: "", //车场名称
      carnames: "",
      onename: "", //一体机编号
      modal_onename: "", //弹框一体机编号
      modules: false, //弹框一体机显示 隐藏
      module_ellipsis: [],
      modal10: false,
      loading1: false,
      loadinges: true,
      loadinges1: true,
      spinShow: false,
      loadingText: "数据加载中...",
      loadingText1: "数据加载中...",
      pages: 1,
      pages1: 1,
      numbers: "",
      numbers1: "",
      condition: {
        condition: {
          bindType: 1,
          parkCode: "",
          screenCode: "",
          pointNumber: "",
          screenOnlineStatus: ""
        },
        pageNo: 1,
        pageSize: 10
      },
      condition1: {
        condition: {
          bindType: 0,
          parkCode: "",
          screenCode: ""
        },
        pageNo: 1,
        pageSize: 5
      },
      data: "",
      show: "",
      columns: [
        {
          title: "设备编号",
          align: "center",
          //   sortable: 'custom',
          key: "screenCode",
          tooltip: "true",
          minWidth: 160
        },
        {
          title: "点位编号",
          align: "center",
          //   sortable: 'custom',
          key: "pointNumber",
          minWidth: 150
        },
        {
          title: "诱导屏位置",
          align: "center",
          //   sortable: 'custom',
          tooltip: "true",
          key: "screenAddress",
          minWidth: 220
        },
        {
          title: "屏体数",
          align: "center",
          //   sortable: 'custom',
          key: "screenSum",
          minWidth: 100
        },
        {
          title: "诱导屏车场",
          //   sortable: 'custom',
          align: "left",
          key: "parkNameList",
          minWidth: 280,
          render: (h, params) => {
            // console.log(params);
            let clist = params.row.parkNameList;
            const list = [];
            let sindex = 0;
            if (clist && clist !== null) {
              // console.log(clist);
              clist.forEach((value, index) => {
                // console.log(index);
                if (index == 0) {
                  list[index] = h(
                    "div",
                    {
                      style: {
                        width: "80px",
                        display: "inline",
                        textAlign: "center",
                        // border: "1px solid #464c5b",
                        borderRadius: "5px",
                        margin: "0 auto"
                      },
                      domProps: {
                        title: params.row.plateNos
                      }
                    },
                    value
                  );
                } else if (index == 1) {
                  list[index] = h(
                    "div",
                    {
                      style: {
                        width: "80px",
                        display: "inline",
                        textAlign: "center",
                        // border: "1px solid #464c5b",
                        borderRadius: "5px",
                        margin: "0 auto"
                      },
                      domProps: {
                        title: params.row.plateNos
                      }
                    },
                    " / " + value
                  );
                } else if (index == 2) {
                  list[index] = h("span", [
                    h(
                      "span",
                      {
                        style: {
                          fontSize: "20px",
                          cursor: "pointer",
                          display: "inline"
                        },
                        on: {
                          click: () => {
                            this.showEllipsis(params.row.id);
                          }
                        }
                      },
                      "..."
                    ),
                    h(
                      "div",
                      {
                        style: {
                          fontSize: "10px",
                          cursor: "pointer",
                          display: "inline",
                          // border: "1px solid red",
                          marginBottom: "20px"
                        },
                        on: {
                          click: () => {
                            this.showEllipsis(params.row.id);
                          }
                        }
                      },
                      clist.length
                    )
                  ]);
                }
              });
            }
            return list;
          }
        },
        {
          title: "状态",
          align: "center",
          key: "screenOnlineStatus",
          minWidth: 80,
          render: (h, params) => {
            // console.log(params.row.screenOnlineStatus )
            let state = params.row.screenOnlineStatus;
            return h(
              "label",
              {
                style: {
                  color: params.row.screenOnlineStatus == 1 ? "green" : "red"
                }
              },
              state === 0 ? "离线" : state === 1 ? "在线" : ""
            );
          }
        },
        {
          title: "运营商",
          align: "center",
          //   sortable: 'custom',
          key: "operators",
          minWidth: 100
        },
        {
          title: "信号强度",
          align: "center",
          //   sortable: 'custom',
          key: "screenSignal",
          minWidth: 110
        },
        {
          title: "操作",
          key: "id",
          minWidth: 170,
          align: "center",
          render: (h, params) => {
            let parking = params.row;
            // console.log(parking);
            let menu = null;
            // if (params.row.fixedId === null) {
            // console.log(params.row);

            // } else {
            menu = h("div", [
              h("i-switch", {
                props: {
                  type: "warning",
                  size: "large",
                  // disabled:
                  //   params.row.fixedId === null,
                  value: params.row.screenFlag === 1 // 控制开关的打开或关闭状态，官网文档属性是value
                },
                style: {
                  // background:'#f66913',
                  // border:'1px solid #f66913'
                  marginRight: "10px"
                },
                scopedSlots: {
                  open: () => h("span", "正常"),
                  close: () => h("span", "禁用")
                },
                on: {
                  "on-change": state => {
                    if (state) {
                      this.enableParking(parking.id);
                    } else {
                      this.disabledParking(parking.id);
                    }
                  }
                }
              }),
              h(
                "span",
                {
                  style: {
                    size: 26,
                    cursor: "pointer",
                    marginRight: "5px"
                  },
                  on: {
                    click: () => {
                      this.edit(parking.id);
                    }
                  }
                },
                "编辑"
              ),
              h(
                "span",
                {
                  style: {
                    size: 26,
                    cursor: "pointer"
                  },
                  on: {
                    click: () => {
                      this.delete(parking.id);
                    }
                  }
                },
                "删除"
              )
            ]);
            // }
            if (params.row.type != 0) {
              return menu;
            }
          }
        }
      ],
      columns1: [
        {
          title: "设备编号",
          align: "center",
          //   sortable: 'custom',
          key: "screenCode",
          minWidth: 120
        },
        {
          title: "状态",
          align: "center",
          key: "screenOnlineStatus",
          minWidth: 90,
          render: (h, params) => {
            // console.log(params.row.screenOnlineStatus )
            let state = params.row.screenOnlineStatus;
            return h(
              "label",
              {
                style: {
                  color: params.row.screenOnlineStatus == 1 ? "green" : "red"
                }
              },
              state === 0 ? "离线" : state === 1 ? "在线" : ""
            );
          }
        },
        // {
        //   title: "运营商",
        //   align: "center",
        //   //   sortable: 'custom',
        //   key: "operators",
        //   minWidth: 90
        // },
        {
          title: "信号强度",
          align: "center",
          //   sortable: 'custom',
          key: "screenSignal",
          minWidth: 100
        },
        {
          title: "厂商ID",
          align: "center",
          //   sortable: 'custom',
          key: "factoryId",
          minWidth: 100
        },
        {
          title: "操作",
          key: "id",
          minWidth: 170,
          align: "center",
          render: (h, params) => {
            let parking = params.row;
            let menu = null;
            // if (params.row.fixedId === null) {
            //   console.log(params.row)

            // } else {
            menu = h("div", [
              h(
                "span",
                {
                  props: {
                    // type: 'md-eye',
                    size: 26,
                    color: "#19be6b"
                  },
                  style: {
                    marginRight: "5px",
                    cursor: "pointer"
                  },
                  on: {
                    click: () => {
                      this.modal_edit(parking.id);
                    }
                  }
                },
                "编辑"
              ),
              h(
                "span",
                {
                  style: {
                    size: 26,
                    cursor: "pointer"
                  },
                  on: {
                    click: () => {
                      this.modal_del(parking.id);
                    }
                  }
                },
                "删除"
              )
            ]);
            // }
            return menu;
          }
        }
      ],
      data: { total: 0, list: [], loading: true },
      data1: { total: 0, list: [], loading: true }
    };
  },
  created() {
    this.loadingText1 = "";
    this.list();
    this.list1();
    this.floores();
  },
  mounted() {
    this.$root.event.$on("logout", res => {
      // console.log(res)
      this.show = res;
    });
  },
  methods: {
    //车场名称
    floores() {
      axios
        .request({
          url: url.url.car_name,
          method: "get"
        })
        .then(res => {
          console.log(res);
          this.carnames = res.data.data;
        });
    },
    //新增一体机
    add() {
      console.log("新增一体机");
      this.modules = true;
    },
    // 弹框编辑
    modal_edit(id) {
      console.log("编辑");
      this.$router.push({
        path: "/induce_administration_add",
        query: {
          id: id
        }
      });
    },
    //弹框删除
    modal_del(id) {
      console.log("删除");
      console.log(id);
      this.show_delete = true;
      this.id_delete = id;
      this.deletes = 2;
    },
    //弹框返回
    module_back() {
      this.modules = false;
    },
    //弹框增加
    modal_add() {
      console.log("增加");
      this.$router.push({
        path: "/induce_administration_add"
      });
    },
    //弹框查询
    sear1() {
      let that = this;
      this.loadinges1 = true;
      console.log("查询");
      that.loadingText1 = "数据加载中...";
      this.data1 = "";
      this.condition1.pageNo = 1;
      if (this.modal_onename) {
        this.condition1.condition.screenCode = this.modal_onename;
      } else {
        this.condition1.condition.screenCode = null;
      }
      console.log(this.condition1);
      axios1
        .request({
          url: url.url.search_screen,
          data: this.condition1,
          method: "post"
        })
        .then(res => {
          console.log(res);
          that.spinShow = false;
          if (res.data.data.list.length == 0) {
            this.loadingText1 = "";
          } else {
            this.data1 = res.data.data;
            this.totalPages1 = res.data.data.totalPages;
          }
          this.numbers1 = 1;
          this.loadinges1 = false;
        });
    },
    //table列表
    list() {
      let that = this;
      this.data = "";
      this.totalPages = "";
      this.condition.pageNo = 1;
      axios1
        .request({
          url: url.url.search_screen,
          data: this.condition,
          method: "post"
        })
        .then(res => {
          console.log(res);
          that.spinShow = false;
          if (res.data.data.list.length == 0) {
            this.loadingText = "";
          } else {
            this.data = res.data.data;
            this.totalPages = res.data.data.totalPages;
          }
          this.loadinges = false;
        });
    },
    list1() {
      let that = this;
      this.condition1.pageNo = 1;
      this.data1 = "";
      this.totalPages1 = 0;
      axios1
        .request({
          url: url.url.search_screen,
          data: this.condition1,
          method: "post"
        })
        .then(res => {
          console.log(res);
          that.spinShow = false;
          if (res.data.data.list.length == 0) {
            this.loadingText1 = "";
          } else {
            this.data1 = res.data.data;
            this.totalPages1 = res.data.data.totalPages;
          }
          this.loadinges1 = false;
        });
    },
    //显示省略车牌号
    showEllipsis(id) {
      console.log(id);
      this.data.list.map(res => {
        // console.log(res);
        if (res.id == id) {
          if (res.parkNameList) {
            this.module_ellipsis = res.parkNameList;
            this.modal10 = true;
          }
        }
      });
    },
    //点击数字第几页
    search(data) {
      let that = this;
      this.data = "";
      this.loadinges = true;
      console.log(data);
      this.pages = data;
      this.condition.pageNo = data;
      axios1
        .request({
          url: url.url.search_screen,
          data: this.condition,
          method: "post"
        })
        .then(res => {
          console.log(res);
          this.numbers = data;
          if (res.data.data.list.length == 0) {
            this.loadingText = "";
          } else {
            this.data = res.data.data;
            this.totalPages = res.data.data.totalPages;
          }
          this.loadinges = false;
        });
    },
    //点击数字第几页
    search1(data) {
      let that = this;
      this.loadinges1 = true;
      console.log(data);
      this.pages = data;
      this.condition1.pageNo = data;
      axios1
        .request({
          url: url.url.search_screen,
          data: this.condition1,
          method: "post"
        })
        .then(res => {
          console.log(res);
          that.spinShow = false;
          this.numbers1 = data;
          if (res.data.data.list.length == 0) {
            this.loadingText1 = "";
          } else {
            this.data1 = res.data.data;
            this.totalPages1 = res.data.data.totalPages;
          }
          this.loadinges1 = false;
        });
    },
    // 输入数字
    number(data) {
      if (data == "") {
        this.numbers = data;
      } else {
        var reg = /^\d{1,}$/;
        if (reg.test(data) == false) {
          this.numbers = 1;
        } else {
          if (data >= 1) {
            this.numbers = data;
          } else {
            this.numbers = 1;
          }
        }
      }
    },
    //输入数字
    number1(data) {
      if (data == "") {
        this.numbers1 = data;
      } else {
        var reg = /^\d{1,}$/;
        console.log(reg.test(data));
        if (reg.test(data) == false) {
          this.numbers1 = 1;
        } else {
          if (data >= 1) {
            this.numbers1 = data;
          } else {
            this.numbers1 = 1;
          }
        }
      }
    },
    //点击按钮跳转第几页
    jump() {
      let that = this;
      this.data = "";
      this.loadinges = true;

      if (this.numbers == "") {
        this.numbers = 1;
      } else if (this.numbers > this.totalPages) {
        this.numbers = this.totalPages;
      }
      this.condition.pageNo = this.numbers;
      axios1
        .request({
          url: url.url.search_screen,
          data: this.condition,
          method: "post"
        })
        .then(res => {
          that.pages = Number(this.numbers);
          if (res.data.data.list.length == 0) {
            this.loadingText = "";
          } else {
            this.data = res.data.data;
          }
          this.loadinges = false;
        });
    },
    //点击按钮跳转第几页
    jump1() {
      let that = this;
      this.loadinges1 = true;
      if (this.numbers1 == "") {
        console.log("1111111111");
        this.numbers1 = 1;
      } else if (this.numbers1 > this.totalPages1) {
        console.log(this.totalPages1);
        this.numbers1 = this.totalPages1 == "" ? "1" : this.totalPages1;
      }
      this.condition1.pageNo = this.numbers1;
      axios1
        .request({
          url: url.url.search_screen,
          data: this.condition1,
          method: "post"
        })
        .then(res => {
          console.log(res);
          that.pages1 = Number(this.numbers1);
          that.spinShow = false;
          if (res.data.data.list.length == 0) {
            this.loadingText1 = "";
          } else {
            this.data1 = res.data.data;
          }
          this.loadinges1 = false;
        });
    },
    del() {
      this.modal10 = false;
    },
    success() {
      this.show = false;
      axios
        .request({
          url: url.url.logout,
          method: "post"
        })
        .then(res => {
          console.log(res);
          if (res.data.logout == true) {
            sessionStorage.setItem("logout", 1);
            this.$router.replace({ path: "/" });
            sessionStorage.setItem("token", "");
          } else {
            this.$Notice.error({
              title: res.data.message,
              desc: ""
            });
          }
        });
    },
    cancel() {
      this.show = false;
    },
    //启用
    enableParking(id) {
      let data = {};
      console.log(id);
      axios1
        .request({
          url: url.url.on_off_screen,
          data: {
            id: id,
            screenFlag: 1
          },
          method: "post"
        })
        .then(res => {
          console.log(res);
          if (res.data.code == 200) {
            this.$Notice.success({
              title: "系统提示",
              desc: res.data.message
            });
          } else {
            this.$Notice.error({
              title: "系统提示",
              desc: res.data.message
            });
          }

          console.log(res);
        });
    },
    //禁用
    disabledParking(id) {
      console.log(id);
      axios1
        .request({
          url: url.url.on_off_screen,
          params: {
            id: id,
            screenFlag: 0
          },
          method: "post"
        })
        .then(res => {
          console.log(res);
          if (res.data.code == 200) {
            this.$Notice.success({
              title: "系统提示",
              desc: res.data.message
            });
          } else {
            this.$Notice.error({
              title: "系统提示",
              desc: res.data.message
            });
          }

          console.log(res);
        });
    },
    //编辑
    edit(id) {
      console.log(id);
      this.$router.push({
        path: "/induce_administration_add",
        query: {
          id: id
        }
      });
    },
    //取消删除
    canceles_delete() {
      this.show_delete = false;
      this.loading_delete = false;
      this.id_delete = "";
    },
    //删除
    delete(id) {
      console.log("删除");
      console.log(id);
      this.show_delete = true;
      this.id_delete = id;
      this.deletes = 1;
    },
    success_delete() {
      this.loading_delete = true;
      console.log(this.modules);
      if (this.modules == true) {
        axios
          .request({
            url: url.url.delete_screen,
            params: {
              id: this.id_delete
            },
            method: "delete"
          })
          .then(res => {
            console.log(res);
            if (res.data.code == 200) {
              this.$Notice.success({
                title: "系统提示",
                desc: res.data.message
              });
              if (this.deletes == 2) {
                this.list1();
              } else if (this.deletes == 1) {
                this.list();
              }
            } else {
              this.$Notice.error({
                title: "系统提示",
                desc: res.data.message
              });
            }
            this.deletes = "";
            this.loading_delete = false;
            this.show_delete = false;
          });
      } else {
        axios
          .request({
            url: url.url.clear_screen,
            params: {
              id: this.id_delete
            },
            method: "delete"
          })
          .then(res => {
            console.log(res);
            if (res.data.code == 200) {
              this.$Notice.success({
                title: "系统提示",
                desc: res.data.message
              });
              this.list1();
              this.list();
            } else {
              this.$Notice.error({
                title: "系统提示",
                desc: res.data.message
              });
            }
            this.deletes = "";
            this.loading_delete = false;
            this.show_delete = false;
          });
      }
    },
    //搜索
    sear() {
      let that = this;
      this.loadinges = true;
      console.log("查询");
      that.loadingText = "数据加载中...";
      this.data = "";
      this.condition.pageNo = 1;
      if (this.carname) {
        this.condition.condition.parkCode = this.carname;
      } else {
        this.condition.condition.parkCode = "";
      }
      if (this.onename) {
        this.condition.condition.screenCode = this.onename;
      } else {
        this.condition.condition.screenCode = null;
      }
      if (this.point_number) {
        this.condition.condition.pointNumber = this.point_number;
      } else {
        this.condition.condition.pointNumber = null;
      }
      if (this.search_state == undefined) {
        this.search_state = null;
        this.condition.condition.screenOnlineStatus = this.search_state;
        console.log("11111111");
      } else {
        this.condition.condition.screenOnlineStatus = this.search_state;
        console.log("22222222222222");
      }
      console.log(this.search_state);
      // console.log(this.condition);
      axios1
        .request({
          url: url.url.search_screen,
          data: this.condition,
          method: "post"
        })
        .then(res => {
          console.log(res);
          if (res.data.data.list.length == 0) {
            this.loadingText = "";
          } else {
            this.data = res.data.data;
            this.totalPages = res.data.data.totalPages;
          }
          this.numbers = 1;
          this.loadinges = false;
        });
    },
    //导出
    out() {
      let that = this;
      that.loading1 = true;
      this.condition.pageSize = 1000;
      axios1
        .request({
          url: url.url.search_screen,
          data: this.condition,
          method: "post"
        })
        .then(res => {
          console.log(res);
          that.spinShow = false;
          if (res.data.data.list.length == 0) {
            this.loadingText = "";
            that.loading1 = false;
            this.$Notice.error({
              title: "系统提示",
              desc: "导出数据不能为空"
            });
          } else {
            let datas = res.data.data.list.map(res => {
              // console.log(res);
              res.screenOnlineStatus =
                res.screenOnlineStatus == 0
                  ? "离线"
                  : res.screenOnlineStatus == 1
                  ? "在线"
                  : "";
              res.parkNameList = res.parkNameList.join("/");

              res.screenSum = res.screenSum == null ? "0" : res.screenSum;
              return res;
            });
            let columns = this.columns.filter(function(col, index) {
              return index < 8;
            });

            this.$refs.currentRowTable.exportCsv({
              filename: "诱导屏管理",
              columns: columns,
              original: false,
              data: datas
            });
            that.loading1 = false;
            this.condition.pageSize = 10;
          }
        });
    }
  }
};
</script>